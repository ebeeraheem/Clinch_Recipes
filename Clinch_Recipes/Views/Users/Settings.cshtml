@using CodeStash.ViewModels
@model UserSettingsViewModel
@{
    ViewData["Title"] = "Settings - CodeStash";
}

<div class="settings-container">
    <div class="container">
        <div class="settings-header">
            <h1><i class="fas fa-cog text-primary me-3"></i>Account Settings</h1>
            <p>Manage your account preferences, privacy settings, and notifications</p>
        </div>

        <!-- Settings Navigation -->
        <div class="settings-nav">
            <ul class="settings-nav-list">
                <li class="settings-nav-item">
                    <a href="#privacy" class="settings-nav-link active" data-section="privacy">
                        <i class="fas fa-shield-alt me-2"></i>Privacy
                    </a>
                </li>
                <li class="settings-nav-item">
                    <a href="#notifications" class="settings-nav-link" data-section="notifications">
                        <i class="fas fa-bell me-2"></i>Notifications
                    </a>
                </li>
                <li class="settings-nav-item">
                    <a href="#display" class="settings-nav-link" data-section="display">
                        <i class="fas fa-palette me-2"></i>Display
                    </a>
                </li>
                <li class="settings-nav-item">
                    <a href="#account" class="settings-nav-link" data-section="account">
                        <i class="fas fa-user-cog me-2"></i>Account
                    </a>
                </li>
            </ul>
        </div>

        <form asp-action="Settings" method="post" id="settingsForm">
            <div class="settings-content">
                <!-- Privacy Settings -->
                <div class="settings-section active" id="privacy-section">
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt"></i>
                        Privacy Settings
                    </h2>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Public Profile</h4>
                                <p>Allow others to view your profile and public notes</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="IsProfilePublic" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Show Email Address</h4>
                                <p>Display your email address on your public profile</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="ShowEmail" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Show Location</h4>
                                <p>Display your location on your public profile</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="ShowLocation" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Show Social Links</h4>
                                <p>Display your social media links on your profile</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="ShowSocialLinks" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Show Statistics</h4>
                                <p>Display your coding statistics and activity on your profile</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="ShowStats" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="settings-section" id="notifications-section">
                    <h2 class="section-title">
                        <i class="fas fa-bell"></i>
                        Notification Preferences
                    </h2>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>New Followers</h4>
                                <p>Get notified when someone follows you</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="EmailOnNewFollower" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Note Comments</h4>
                                <p>Get notified when someone comments on your notes</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="EmailOnNoteComment" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Note Likes</h4>
                                <p>Get notified when someone likes your notes</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="EmailOnNoteLike" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Weekly Digest</h4>
                                <p>Receive a weekly summary of your activity and trending notes</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="WeeklyDigest" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Marketing Emails</h4>
                                <p>Receive emails about new features and CodeStash updates</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="MarketingEmails" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Display Settings -->
                <div class="settings-section" id="display-section">
                    <h2 class="section-title">
                        <i class="fas fa-palette"></i>
                        Display Preferences
                    </h2>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Theme</h4>
                                <p>Choose your preferred color theme</p>
                            </div>
                            <div class="setting-control">
                                <select asp-for="Theme" class="form-select">
                                    @foreach (var theme in Model.AvailableThemes)
                                    {
                                        <option value="@theme" selected="@(Model.Theme == theme)">
                                            @(theme == "dark" ? "Dark" : theme == "light" ? "Light" : "Auto (System)")
                                        </option>
                                    }
                                </select>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Notes Per Page</h4>
                                <p>Number of notes to display per page</p>
                            </div>
                            <div class="setting-control">
                                <select asp-for="NotesPerPage" class="form-select">
                                    <option value="6" selected="@(Model.NotesPerPage == 6)">6</option>
                                    <option value="12" selected="@(Model.NotesPerPage == 12)">12</option>
                                    <option value="24" selected="@(Model.NotesPerPage == 24)">24</option>
                                    <option value="48" selected="@(Model.NotesPerPage == 48)">48</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Default Note Visibility</h4>
                                <p>Default privacy setting for new notes</p>
                            </div>
                            <div class="setting-control">
                                <select asp-for="DefaultNoteVisibility" class="form-select">
                                    <option value="public" selected="@(Model.DefaultNoteVisibility == "public")">Public</option>
                                    <option value="private" selected="@(Model.DefaultNoteVisibility == "private")">Private</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Code Editor Font Size</h4>
                                <p>Font size for the code editor</p>
                            </div>
                            <div class="setting-control">
                                <select asp-for="EditorFontSize" class="form-select">
                                    <option value="12" selected="@(Model.EditorFontSize == 12)">12px</option>
                                    <option value="14" selected="@(Model.EditorFontSize == 14)">14px</option>
                                    <option value="16" selected="@(Model.EditorFontSize == 16)">16px</option>
                                    <option value="18" selected="@(Model.EditorFontSize == 18)">18px</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Show Line Numbers</h4>
                                <p>Display line numbers in code blocks</p>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input asp-for="ShowLineNumbers" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div class="settings-section" id="account-section">
                    <h2 class="section-title">
                        <i class="fas fa-user-cog"></i>
                        Account Management
                    </h2>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Change Password</h4>
                                <p>Update your account password for security</p>
                            </div>
                            <div class="setting-control">
                                <a asp-action="ChangePassword" class="btn btn-secondary">
                                    <i class="fas fa-key"></i> Change Password
                                </a>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Export Data</h4>
                                <p>Download a copy of all your notes and data</p>
                            </div>
                            <div class="setting-control">
                                <button type="button" class="btn btn-secondary" onclick="exportData()">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Two-Factor Authentication</h4>
                                <p>Add an extra layer of security to your account</p>
                            </div>
                            <div class="setting-control">
                                <button type="button" class="btn btn-secondary" onclick="setup2FA()">
                                    <i class="fas fa-shield-alt"></i> Enable 2FA
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="danger-zone">
                        <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                        <p>These actions are irreversible. Please be certain before proceeding.</p>
                        <button type="button" class="btn btn-danger" onclick="confirmDeleteAccount()">
                            <i class="fas fa-trash"></i> Delete Account
                        </button>
                    </div>
                </div>

                <!-- Save Actions -->
                <div class="save-actions">
                    <div class="save-status" id="saveStatus">
                        Last saved: <span id="lastSavedTime">2025-06-08 at 3:20 PM</span>
                    </div>
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('.settings-nav-link');
        const sections = document.querySelectorAll('.settings-section');
        const form = document.getElementById('settingsForm');
        const saveBtn = document.getElementById('saveBtn');
        const saveStatus = document.getElementById('saveStatus');
        const lastSavedTime = document.getElementById('lastSavedTime');

        // Navigation handling
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();

                const targetSection = link.dataset.section;

                // Update active nav
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                // Show target section
                sections.forEach(s => s.classList.remove('active'));
                document.getElementById(`${targetSection}-section`).classList.add('active');
            });
        });

        // Auto-save on change
        const autoSaveElements = form.querySelectorAll('input, select');
        autoSaveElements.forEach(element => {
            element.addEventListener('change', () => {
                markAsUnsaved();
            });
        });

        // Form submission
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            saveSettings();
        });

        function markAsUnsaved() {
            saveStatus.className = 'save-status';
            saveStatus.innerHTML = '<i class="fas fa-circle text-warning me-1"></i> Unsaved changes';
        }

        function saveSettings() {
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

            // Simulate API call
            setTimeout(() => {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';

                const now = new Date();
                const timeString = now.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                }) + ' at ' + now.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });

                lastSavedTime.textContent = timeString;
                saveStatus.className = 'save-status saved';
                saveStatus.innerHTML = '<i class="fas fa-check-circle text-success me-1"></i> All changes saved';

                // Show success message
                showNotification('Settings saved successfully!', 'success');
            }, 1500);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 100px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
    });

    function exportData() {
        if (confirm('This will generate a download containing all your notes and profile data. Continue?')) {
            // Simulate export process
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparing...';
            btn.disabled = true;

            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                alert('Export will be available for download in your email within 10 minutes.');
            }, 3000);
        }
    }

    function setup2FA() {
        alert('Two-Factor Authentication setup will be implemented in a future update.');
    }

    function confirmDeleteAccount() {
        const confirmation = prompt('This action cannot be undone. Type "DELETE" to confirm account deletion:');
        if (confirmation === 'DELETE') {
            if (confirm('Are you absolutely sure? This will permanently delete your account and all your notes.')) {
                alert('Account deletion functionality will be implemented with additional security measures.');
            }
        }
    }
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}



<style>
    .settings-container {
        background: var(--bg-primary);
        min-height: calc(100vh - 76px);
        padding: 2rem 0;
    }

    .settings-header {
        background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
    }

        .settings-header h1 {
            color: var(--text-primary);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .settings-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

    .settings-nav {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .settings-nav-list {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .settings-nav-item {
        flex: 1;
    }

    .settings-nav-link {
        display: block;
        padding: 1rem 1.5rem;
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.2s ease;
        border-right: 1px solid var(--border-primary);
        text-align: center;
    }

    .settings-nav-item:last-child .settings-nav-link {
        border-right: none;
    }

    .settings-nav-link:hover,
    .settings-nav-link.active {
        background: var(--accent-primary);
        color: white;
    }

    .settings-content {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        border-radius: 12px;
        padding: 0;
        overflow: hidden;
    }

    .settings-section {
        padding: 2.5rem;
        border-bottom: 1px solid var(--border-primary);
        display: none;
    }

        .settings-section.active {
            display: block;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

    .section-title {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

        .section-title i {
            color: var(--accent-primary);
        }

    .setting-group {
        margin-bottom: 2.5rem;
    }

        .setting-group:last-child {
            margin-bottom: 0;
        }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        background: var(--bg-primary);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        margin-bottom: 1rem;
    }

        .setting-item:last-child {
            margin-bottom: 0;
        }

    .setting-info h4 {
        color: var(--text-primary);
        margin: 0 0 0.5rem 0;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .setting-info p {
        color: var(--text-secondary);
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .setting-control {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .toggle-switch {
        position: relative;
        width: 60px;
        height: 34px;
    }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--text-secondary);
        transition: 0.4s;
        border-radius: 34px;
    }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

    input:checked + .toggle-slider {
        background-color: var(--accent-primary);
    }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

    .form-select {
        padding: 0.75rem 1rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: 6px;
        color: var(--text-primary);
        font-size: 0.95rem;
        min-width: 150px;
    }

        .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

    .danger-zone {
        background: rgba(220, 53, 69, 0.05);
        border: 1px solid rgba(220, 53, 69, 0.2);
        border-radius: 8px;
        padding: 2rem;
        margin-top: 2rem;
    }

        .danger-zone h3 {
            color: #dc3545;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .danger-zone p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 6px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
        color: white;
    }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }

    .btn-danger {
        background: #dc3545;
        color: white;
    }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

    .btn-secondary {
        background: var(--text-secondary);
        color: white;
    }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

    .save-actions {
        position: sticky;
        bottom: 0;
        background: var(--bg-tertiary);
        border-top: 1px solid var(--border-primary);
        padding: 1.5rem 2.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .save-status {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

        .save-status.saved {
            color: #28a745;
        }

    @@media (max-width: 768px) {
        .settings-nav-list

    {
        flex-direction: column;
    }

    .settings-nav-link {
        border-right: none;
        border-bottom: 1px solid var(--border-primary);
    }

    .settings-nav-item:last-child .settings-nav-link {
        border-bottom: none;
    }

    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .settings-section {
        padding: 1.5rem;
    }

    .save-actions {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }

    }
</style>


